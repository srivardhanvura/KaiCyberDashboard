(()=>{"use strict";var e={3890:(e,t,o)=>{var s=o(4250);class a extends s.Ay{constructor(){super("kai-dashboard-db"),this.vulns=void 0,this.aggSeverity=void 0,this.version(3).stores({vulns:"\n        id,\n        severity,\n        publishedAt,\n        cvss,\n        kaiStatus,\n        description,\n        discoveredAt,\n        *riskFactors,\n        *tags,\n        [severity+publishedAt],\n        [kaiStatus+severity],\n        [discoveredAt+severity]\n      ",aggSeverity:"severity"})}}const r=new a;function n(e){self.postMessage(e)}self.onmessage=e=>{var t;"START"===(null===(t=e.data)||void 0===t?void 0:t.type)&&g().catch(e=>n({type:"ERROR",message:String((null===e||void 0===e?void 0:e.message)||e)}))};const i=e=>{const t=(null!==e&&void 0!==e?e:"unknown").toString().toLowerCase();return"critical"===t||"high"===t||"medium"===t||"low"===t?t:"unknown"},c=()=>{const e=Math.floor(3*Math.random())+1;return["production","staging","development","security-critical","public-facing","internal","legacy","new-feature"].sort(()=>.5-Math.random()).slice(0,e)},l=e=>e?Date.parse(e):void 0,g=async()=>{try{let e;console.log("Starting streaming data ingestion..."),await r.transaction("rw",r.vulns,r.aggSeverity,async()=>{await r.vulns.clear(),await r.aggSeverity.clear()}),console.log("Cleared existing data"),console.log("Using GitHub download URL for regular file");const t=await fetch("https://media.githubusercontent.com/media/chanduusc/Ui-Demo-Data/main/ui_demo.json",{cache:"no-store",redirect:"follow",mode:"cors",headers:{Accept:"application/json"}});if(!t.ok)throw new Error("Download failed: ".concat(t.status," ").concat(t.statusText));e=t,console.log("Data fetch initiated from GitHub API");const s=await e.json();console.log("JSON parsed successfully");const a=1e4,g=[],u=new Map;let v=0;const d=Object.values(s.groups);console.log("Found ".concat(d.length," groups to process"));const p=10;for(let f=0;f<d.length;f+=p){const e=d.slice(f,f+p);for(const t of e){const e=Object.values(t.repos||{});for(const s of e){const e=Object.values(s.images||{});for(const d of e)if(d.vulnerabilities&&Array.isArray(d.vulnerabilities))for(const e of d.vulnerabilities){const p=l(e.published),f=l(e.fixDate),h=Object.keys(e.riskFactors||{}),y=d.id||d.name||"",m="".concat(y,"|").concat(e.cve||"","|").concat(e.packageName||"","|").concat(e.packageVersion||""),w=i(e.severity),b=Date.now(),k=p||b,S={id:m,group:t.name||"",repo:s.name||"",imageId:y,imageName:d.name||"",imageVersion:d.version,cve:e.cve,severity:w,cvss:"number"===typeof e.cvss?e.cvss:void 0,description:e.description||"",status:e.status,packageName:e.packageName,packageVersion:e.packageVersion,packageType:e.packageType,publishedAt:p,fixDate:f,riskFactors:h,kaiStatus:e.kaiStatus||"",discoveredAt:Math.floor(k),exploitabilityScore:e.cvss?Math.random()*e.cvss:void 0,impactScore:e.cvss?e.cvss-Math.random()*e.cvss*.5:void 0,tags:c()};g.push(S),u.set(w,(u.get(w)||0)+1),g.length>=a&&(console.log("Processing batch of ".concat(g.length," rows, total so far: ").concat(v+g.length)),await r.vulns.bulkPut(g),v+=g.length,n({type:"PROGRESS",rowsWritten:v}),g.length=0,"undefined"!==typeof o.g&&o.g.gc&&o.g.gc())}}}v>0&&n({type:"PROGRESS",rowsWritten:v}),await new Promise(e=>setTimeout(e,10))}g.length>0&&(await r.vulns.bulkPut(g),v+=g.length,n({type:"PROGRESS",rowsWritten:v})),console.log("Writing severity aggregates..."),console.log("Severity counts map:",Object.fromEntries(u)),await r.transaction("rw",r.aggSeverity,async()=>{await r.aggSeverity.clear();const e=[];u.forEach((t,o)=>e.push({severity:o,count:t})),console.log("Aggregate rows to insert:",e),e.length?(await r.aggSeverity.bulkPut(e),console.log("Aggregates inserted successfully")):console.log("No aggregates to insert")}),console.log("Ingestion completed: ".concat(v," rows processed")),n({type:"DONE",rowsWritten:v})}catch(e){console.error("Ingest error:",e),n({type:"ERROR",message:String((null===e||void 0===e?void 0:e.message)||e)})}}}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,o),r.exports}o.m=e,o.x=()=>{var e=o.O(void 0,[250],()=>o(3890));return e=o.O(e)},(()=>{var e=[];o.O=(t,s,a,r)=>{if(!s){var n=1/0;for(g=0;g<e.length;g++){for(var[s,a,r]=e[g],i=!0,c=0;c<s.length;c++)(!1&r||n>=r)&&Object.keys(o.O).every(e=>o.O[e](s[c]))?s.splice(c--,1):(i=!1,r<n&&(n=r));if(i){e.splice(g--,1);var l=a();void 0!==l&&(t=l)}}return t}r=r||0;for(var g=e.length;g>0&&e[g-1][2]>r;g--)e[g]=e[g-1];e[g]=[s,a,r]}})(),o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,s)=>(o.f[s](e,t),t),[])),o.u=e=>"static/js/"+e+".f26b7297.chunk.js",o.miniCssF=e=>{},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.p="/",(()=>{var e={890:1};o.f.i=(t,s)=>{e[t]||importScripts(o.p+o.u(t))};var t=self.webpackChunkkaicyber_dashboard=self.webpackChunkkaicyber_dashboard||[],s=t.push.bind(t);t.push=t=>{var[a,r,n]=t;for(var i in r)o.o(r,i)&&(o.m[i]=r[i]);for(n&&n(o);a.length;)e[a.pop()]=1;s(t)}})(),(()=>{var e=o.x;o.x=()=>o.e(250).then(e)})();o.x()})();
//# sourceMappingURL=890.6e152656.chunk.js.map